# Sample Info

| SHA256|
|---------------------------------------------------------------------------------|
|5c65955da2b6e996c378858d6a886bad85e969fd42509053794cb8ad64630894 |

* Size:  356.650 bytes
* First seen:  2024-05-11 07:06:46 UTC
* File Type:  .js

# Analysis
I found the sample on malware bazaar and wanted to take a look at jscript malware after a long while

# Stage 1
After running it through an deobfuscator to make it more readable, I can finally start analysing.
The first part defines some functions vital for decrypting the second stage. This is done using JavaScript's "String.prototype".


![image](https://github.com/vrrmin/re-stuff/assets/97342354/1cf3a6c8-334a-4795-9a0d-d792e4991ec2)

* function xX7r0lQ() => this function resolves a string using a "key", which is then stored in the variable (function) "PRNT_LN". Instead of taking inputs, this function uses "this" to access the "key". The "key" is a sequence of numbers in string-form.
* function load(cont, str, nid) => load() has two purposes: first, it is used to store the result of xX7r0lQ's results in "PRNT_LN"

As mentioned, the main decrypt function uses a sequence of numbers to resolve a full string by taking a substring according to the numbers.
This function writes "prototype" in the variable "PRNT_LN", which is used below to define the void function "h5aLFnU"

* function h5aLFnU => basically replaces "placeholders" in a string with given string(s). 

There is a big chunk of b64 with tons of these placeholders. These will get replaced and the result is the second stage with b64 encryption.
![image](https://github.com/vrrmin/re-stuff/assets/97342354/506fdecb-fa9b-4e30-9370-43921c438fd2)


The code creates the WSH Object "microsoft.xmldom", which is used to decrypt the b64 and then run it using the eval() function later on. Before that, the code gets written onto an array using the WSH Object "adodb.stream". Then the execution of the second stage begins.

# Stage 2

![image](https://github.com/vrrmin/re-stuff/assets/97342354/5a7fb246-f4d6-4d23-9c8b-c96ecb74ad81)

The second stage is not as interesting. It decodes a huge b64 chunk using regex, writes it to /appdata/roaming and executes the decoded .jar file via jre. If jre is not installed, it installs it.

# Stage 3
