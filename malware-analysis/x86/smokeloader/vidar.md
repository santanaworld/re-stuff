# Sample Info

| SHA256|
|---------------------------------------------------------------------------------|
|5756eb17961a1facf1f1c972dde0185932f10f7e7a6b3e756ac785418887eb26 |

* Size:	288'808 bytes
* First seen:  2024-09-11 19:14:17 UTC
* File Type:  .exe

# About

Vidar is a forked malware based on Arkei. It seems this stealer is one of the first that is grabbing information on 2FA Software and Tor Browser. (source: https://malpedia.caad.fkie.fraunhofer.de/details/win.vidar)

# Analysis

First, we have a loader for the actual payload written in .NET, which luckily is fairly easy to understand. 

![image](https://github.com/user-attachments/assets/7c352b9e-7fb0-4d88-9a3e-22b010d49559)


Just breakpoint at VirtualProtectEx (step once) and dump the memory segment with the payload in it. I used Process Hacker 2 for this, but there are probably other ways to do it.

#Stage 2

| SHA256|
|---------------------------------------------------------------------------------|
|66db333051ad5cc738603bddf601e2fdc2c60105d02a6d89d16c53f861983a61 |

* Size:	264 kilobytes
* File Type:  .exe


So lets start analyzing the actual thing. Upon loading it in IDA, the first thing an experienced eye will notice, is that the malware use opaque predicates. This turns a normal "jmp" instruction into two "jz" and "jnz"
instructions, which confuses the disassembler to output falseful code. Since the zero flag is always either 0 or 1, one of the jumps must be taken. So, patching the first "jz" instruction to a normal "jmp" and replacing the second conditional jump with nops fixes the issue.

![image](https://github.com/user-attachments/assets/1223b506-770d-4a1c-acbc-ce84f79fcef2)



